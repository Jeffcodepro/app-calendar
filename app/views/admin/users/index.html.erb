<div class="admin-users">
  <div class="admin-users__header">
    <div>
      <p class="admin-users__kicker">Gestao</p>
      <h1 class="admin-users__title">Lista de funcionários</h1>
      <p class="admin-users__subtitle">Acompanhe acessos, férias e histórico do time.</p>
    </div>
  </div>

  <section class="admin-users__section">
    <div class="admin-users__section-header">
      <h2 class="admin-users__section-title">Aprovação de acesso</h2>
      <p class="admin-users__section-subtitle">Novos usuários aguardando liberação.</p>
    </div>
    <% if @pending_users.any? %>
      <div class="admin-users__table">
        <table class="table table-borderless align-middle">
          <thead>
            <tr>
              <th>Usuário</th>
              <th>Criado em</th>
              <th class="text-end">Ações</th>
            </tr>
          </thead>
          <tbody>
            <% @pending_users.each do |user| %>
              <tr>
                <td><%= user.display_name %></td>
                <td><%= user.created_at.strftime("%d/%m/%Y") %></td>
                <td class="text-end">
                  <%= link_to "Aprovar", approve_admin_user_path(user), data: { turbo_method: :patch }, class: "admin-users__button admin-users__button--primary" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="admin-users__empty">Nenhum usuário pendente.</p>
    <% end %>
  </section>

  <section class="admin-users__section">
    <div class="admin-users__section-header">
      <h2 class="admin-users__section-title">Aprovação de férias</h2>
      <p class="admin-users__section-subtitle">Análise os pedidos pendentes do calendário.</p>
    </div>
    <% if @pending_vacation_requests.any? %>
      <div class="admin-users__table">
        <table class="table table-borderless align-middle">
          <thead>
            <tr>
              <th>Usuário</th>
              <th>Período</th>
              <th>Status</th>
              <th class="text-end">Ações</th>
            </tr>
          </thead>
          <tbody>
            <% @pending_vacation_requests.each do |request| %>
              <tr>
                <td><%= request.user.display_name %></td>
                <td><%= request.period_label %></td>
                <td><span class="admin-users__badge"><%= request.status_label %></span></td>
                <td class="text-end">
                  <%= link_to "Aprovar", approve_admin_vacation_request_path(request), data: { turbo_method: :patch }, class: "admin-users__button admin-users__button--primary" %>
                  <%= link_to "Recusar", reject_admin_vacation_request_path(request), data: { turbo_method: :patch }, class: "admin-users__button admin-users__button--ghost" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="admin-users__empty">Nenhuma solicitação pendente.</p>
    <% end %>
  </section>

  <section class="admin-users__section">
    <div class="admin-users__section-header">
      <h2 class="admin-users__section-title">Histórico de férias</h2>
      <p class="admin-users__section-subtitle">Visualize períodos já concluídos.</p>
    </div>
    <div class="admin-users__section-actions">
      <%= link_to "Exportar Excel", export_vacation_history_admin_users_path, class: "admin-users__button admin-users__button--ghost" %>
    </div>
    <% if @vacation_history.any? %>
      <div class="admin-users__table">
        <table class="table table-borderless align-middle">
          <thead>
            <tr>
              <th>Usuário</th>
              <th>Período</th>
              <th>Encerrado em</th>
              <th>Status</th>
              <th class="text-end">Ações</th>
            </tr>
          </thead>
          <tbody>
            <% @vacation_history.each do |request| %>
              <tr>
                <td><%= request.user.display_name %></td>
                <td><%= request.period_label %></td>
                <td><%= request.end_date.strftime("%d/%m/%Y") %></td>
                <td><span class="admin-users__badge"><%= request.status_label %></span></td>
                <td class="text-end">
                  <% if request.start_date > Date.current %>
                    <%= link_to "Excluir", admin_vacation_request_path(request),
                          data: { turbo_method: :delete, turbo_confirm: "Tem certeza?" },
                          class: "admin-users__button admin-users__button--danger" %>
                  <% else %>
                    <span class="admin-users__muted">Histórico fechado</span>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <% if @vacation_history_total_pages > 1 %>
        <div class="admin-users__pager">
          <% if @history_page > 1 %>
            <%= link_to "Anterior", admin_users_path(history_page: @history_page - 1, active_page: @active_page), class: "admin-users__pager-link" %>
          <% end %>
          <span class="admin-users__pager-info">Pagina <%= @history_page %> de <%= @vacation_history_total_pages %></span>
          <% if @history_page < @vacation_history_total_pages %>
            <%= link_to "Proxima", admin_users_path(history_page: @history_page + 1, active_page: @active_page), class: "admin-users__pager-link" %>
          <% end %>
        </div>
      <% end %>
    <% else %>
      <p class="admin-users__empty">Nenhuma férias concluída.</p>
    <% end %>
  </section>

  <section class="admin-users__section">
    <div class="admin-users__section-header">
      <h2 class="admin-users__section-title">Usuários ativos</h2>
      <p class="admin-users__section-subtitle">Equipe ativa no aplicativo.</p>
    </div>
    <% if @active_users.any? %>
      <div class="admin-users__table">
        <table class="table table-borderless align-middle">
          <thead>
            <tr>
              <th>Usuário</th>
              <th>Função</th>
              <th class="text-end">Ações</th>
            </tr>
          </thead>
          <tbody>
            <% @active_users.each do |user| %>
              <tr>
                <td><%= user.display_name %></td>
                <td><%= user.role %></td>
                <td class="text-end">
                  <%= link_to "Editar", edit_admin_user_path(user), class: "admin-users__button admin-users__button--ghost" %>
                  <%= link_to "Excluir", admin_user_path(user), data: { turbo_method: :delete, turbo_confirm: "Tem certeza?" }, class: "admin-users__button admin-users__button--danger" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <% if @active_users_total_pages > 1 %>
        <div class="admin-users__pager">
          <% if @active_page > 1 %>
            <%= link_to "Anterior", admin_users_path(active_page: @active_page - 1, history_page: @history_page), class: "admin-users__pager-link" %>
          <% end %>
          <span class="admin-users__pager-info">Página <%= @active_page %> de <%= @active_users_total_pages %></span>
          <% if @active_page < @active_users_total_pages %>
            <%= link_to "Próxima", admin_users_path(active_page: @active_page + 1, history_page: @history_page), class: "admin-users__pager-link" %>
          <% end %>
        </div>
      <% end %>
    <% else %>
      <p class="admin-users__empty">Nenhum usuário ativo.</p>
    <% end %>
  </section>
</div>
