<% dashboard_active = controller_name == "dashboards" %>
<% calendar_active = controller_name == "calendars" %>
<% admin_users_active = controller_path == "admin/users" %>
<% profile_active = controller_name == "registrations" %>

<nav class="navbar navbar-expand-sm navbar-light navbar-lewagon">
  <div class="container-fluid">
    <%= link_to dashboard_path, class: "navbar-brand" do %>
      <%= image_tag "https://raw.githubusercontent.com/lewagon/fullstack-images/master/uikit/logo.png" %>
    <% end %>

    <%# ====== MOBILE (<sm): só o dropdown do avatar com TODAS as opções ====== %>
    <div class="d-sm-none ms-auto dropdown">
      <a href="#" class="nav-link navbar-toggler" id="mobileAvatarDropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" aria-label="Abrir menu">
        <span class="navbar-toggler-icon"></span>
      </a>

      <div class="dropdown-menu dropdown-menu-end" aria-labelledby="mobileAvatarDropdown">
        <%= link_to "Painel", dashboard_path, class: "dropdown-item#{' active' if dashboard_active}" %>
        <%= link_to "Calendário", calendar_path(grupo: current_user.role), class: "dropdown-item#{' active' if calendar_active}" %>

        <% if current_user.admin? %>
          <%= link_to "Lista de Funcionários", admin_users_path, class: "dropdown-item#{' active' if admin_users_active}" %>
        <% end %>

        <div class="dropdown-divider"></div>
        <%= link_to "Perfil", edit_user_registration_path, class: "dropdown-item#{' active' if profile_active}" %>
        <%= link_to "Sair",
              destroy_user_session_path,
              data: { turbo_method: :delete },
              class: "dropdown-item" %>
      </div>
    </div>

    <%# ====== DESKTOP (>=sm): links normais (sem dropdown) ====== %>
    <div class="collapse navbar-collapse d-none d-sm-flex" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto">
        <li class="nav-item">
          <%= link_to "Painel", dashboard_path, class: "nav-link#{' active' if dashboard_active}" %>
        </li>

        <li class="nav-item">
          <%= link_to "Calendário", calendar_path(grupo: current_user.role), class: "nav-link#{' active' if calendar_active}" %>
        </li>

        <% if current_user.admin? %>
          <li class="nav-item">
            <%= link_to "Lista de Funcionários", admin_users_path, class: "nav-link#{' active' if admin_users_active}" %>
          </li>
        <% end %>
      </ul>

      <ul class="navbar-nav">
        <li class="nav-item">
          <%= link_to "Perfil", edit_user_registration_path, class: "nav-link#{' active' if profile_active}" %>
        </li>
        <li class="nav-item">
          <%= link_to "Sair",
                destroy_user_session_path,
                data: { turbo_method: :delete },
                class: "nav-link" %>
        </li>
      </ul>
    </div>
  </div>
</nav>
